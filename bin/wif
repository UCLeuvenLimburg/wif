#!/usr/bin/env python

from wif.io import *
import argparse
import sys
import re


def studio_convert(args):
    for block in read_blocks(sys.stdin):
        image = block_to_image(block)
        image.save(sys.stdout.buffer, format=args.format)


def convert(args):
    def filename(index):
        return re.sub('%d', str(index).rjust(5, '0'), args.filename)

    for index, block in enumerate(read_blocks(sys.stdin)):
        image = block_to_image(block)
        image.save(filename(index), format=args.format)


parser = argparse.ArgumentParser(prog='wif')
subparsers = parser.add_subparsers(help='sub-command help')

studio_parser = subparsers.add_parser('studio-convert', help='converts stdin (from raytracer) to series of pngs on stdout')
studio_parser.add_argument('--format', type=str, default='png')
studio_parser.set_defaults(func=studio_convert)

convert_parser = subparsers.add_parser('convert', help='converts stdin (from raytracer) to png files')
convert_parser.add_argument('filename', type=str)
convert_parser.add_argument('--format', type=str, default='png')
convert_parser.set_defaults(func=convert)

args = parser.parse_args(sys.argv[1:])
args.func(args)
